#-------------------------------------------------------------------------------
# scFlowKit: A Modular Single-Cell RNA-seq Analysis Pipeline
#-------------------------------------------------------------------------------

# 项目信息
# Name: scFlowKit
# Description: 一个模块化的单细胞 RNA-seq 分析流程，支持 R 和 Python
# GitHub: https://github.com/chriswang001121/scFlowKit
# License: MIT License
# Version: [占位，待后续补充]

# 作者信息
# Name: chriswang001121
# Email: chriswang001121@gmail.com
# Homepage: https://scholar.pulppoetry.org
# LinkedIn: https://www.linkedin.com/in/yibin-zhou


# 当前版本功能
# - 数据加载：支持 10X Genomics 数据格式（.h5 或 .mtx）

#-------------------------------------------------------------------------------


#-------------------------------------------------------------------------------

# 安装依赖包
#-------------------------------------------------------------------------------

# 请先运行 Rutils/install.R 安装必要的依赖包 (初次运行main.R时)
# 运行以下命令：
# source("Rutils/install.R")

#-------------------------------------------------------------------------------


#-------------------------------------------------------------------------------

# 载入依赖包
#-------------------------------------------------------------------------------

# 自动载入必要的依赖包
# 运行以下命令：
source("Rutils/load.R")

#-------------------------------------------------------------------------------


#-------------------------------------------------------------------------------

# 全局参数设置
#-------------------------------------------------------------------------------

# 数据路径：指定输入数据的基础路径，告诉程序从哪里加载单细胞数据
# - 应指向 data/raw/ 文件夹，具体数据集子路径（如 pbmc3k）由模块函数指定
# - 示例：如果你的数据在 data/raw/pbmc3k/ 文件夹，保持此值为 "data/raw/"
data_path <- "data/raw/"

# 输出目录：指定分析结果的保存路径，告诉程序把结果保存在哪里
# - 分析结果（比如图表、表格）会保存在此目录下的 figures/ 和 tables/ 子文件夹
# - 示例：如果想保存在 results/run1/ 文件夹，设置为 "results/run1/"
output_dir <- "results/"

# 设置系统报错语言为英文，便于调试和阅读
# - 在非英文环境下运行 R 时，确保错误信息以英文显示
Sys.setenv(LANGUAGE = "en")

# 禁止字符向量自动转换为因子，提升数据处理灵活性
# - 处理单细胞数据时，避免字符型元数据（如细胞名）被转为因子
options(stringsAsFactors = FALSE)


#-------------------------------------------------------------------------------


#-------------------------------------------------------------------------------
# 主流程：单细胞 RNA-seq 分析
# 主分析代码从这里开始
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
# 步骤 1：数据导入
#-------------------------------------------------------------------------------

# 导入数据加载模块
source("Rutils/load_data.R")

# 指定数据集名称（用户可根据实际数据集调整）
dataset_name <- "sample"

# 加载数据
message("步骤 1：正在加载单细胞 RNA-seq 数据...")
sce <- load_data(base_path = data_path, 
                 dataset_name = dataset_name,
                 min_cells = 3,          # 基因至少在 3 个细胞中表达
                 min_features = 40,      # 细胞至少表达 40 个基因
                 project = "scFlowKit",  # Seurat 对象项目名称
                 assay = "RNA")          # 测序类型

# 输出基本信息，确认加载成功
message("Seurat 对象基本信息：")
print(sce)

#-------------------------------------------------------------------------------